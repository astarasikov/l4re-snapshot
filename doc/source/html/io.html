<html>
  <head>
    <title>L4Re Reference Manual</title>      
    <link href="doxygen.css" rel="stylesheet" type="text/css">
    <link href="tabs.css" rel="stylesheet" type="text/css">
  </HEAD>

  <body style="background: #fff url(header-bg.png) repeat-x scroll 0 0">
   <div>
    <div style="text-align: center; margin-bottom: 10px; border-width: 0 0 1px 0; border-color: #000; border-style: solid">
    L4Re - L4 Runtime Environment
    </div>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="l4re_servers.html">L4Re Servers</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Io, the Io Server </h1>  </div>
</div>
<div class="contents">
<p>The Io server handles all platform devices and resources such as I/O memory, ports (on x86) and interrupts, and grants access to those to clients.</p>
<p>Upon startup Io discovers all platform devices using available means on the system, e.g. on x86 the PCI bus is scanned and the ACPI subsystem initialised. Available I/O resource can also be configured statically.</p>
<p>Each Io server client is provided with its own virtual bus which it can iterate to find devices. A virtual PCI bus may be a part of this virtual bus.</p>
<div align="center">
<img src="io-overview.png" alt="io-overview.png"/>
<p><strong>IO Service Architecture Overview</strong></p></div>
  The Io server must be configured to create virtual buses for its clients. This is done with at least one configuration file specifying static resources as well as virtual buses for clients. The configuration may be split across several configuration files passed to Io through the command line.</p>
<p>The platform configuration is stored in the structure called <code>hw-root</code>. It lists devices that are available on the platform. For the x86 architecture a basic set of platform devices is defined in the file <code>x86-legacy.devs</code>. There are configuration files for various ARM platforms available, as well. If the system contains a PCI bus, it is scanned automatically and the devices found on it are added automatically to the pool of available devices.</p>
<p>To allow clients access to a available devices, a virtual system bus needs to be created that lists the devices that should be available to that client. These buses have a name that Io uses to register a vbus object in its name space.</p>
<p>A very simple configuration for Io could look like this:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"># Example configuration for io</span>
<span class="preprocessor"></span>
<span class="preprocessor"># Configure 2 platform device to be known to io</span>
<span class="preprocessor"></span>hw-root
{
  FOODEVICE =&gt; <span class="keyword">new</span> Device()
  {
    .hid = <span class="stringliteral">&quot;FOODEVICE&quot;</span>;
    <span class="keyword">new</span>-res Irq(17);
    <span class="keyword">new</span>-res Mmio(0x6f000000 .. 0x6f007fff);
  }

  BARDEVICE =&gt; <span class="keyword">new</span> Device()
  {
    .hid = <span class="stringliteral">&quot;BARDEVICE&quot;</span>;
    <span class="keyword">new</span>-res Irq(19);
    <span class="keyword">new</span>-res Irq(20);
    <span class="keyword">new</span>-res Mmio(0x6f100000 .. 0x6f100fff);
  }
}

<span class="preprocessor"># Create a virtual bus for a client and give access to FOODEVICE</span>
<span class="preprocessor"></span>client1 =&gt; <span class="keyword">new</span> System_bus()
{
  dev =&gt; wrap(hw-root.FOODEVICE);
}

<span class="preprocessor"># Create a virtual bus for another client and give it access to</span>
<span class="preprocessor"></span><span class="preprocessor"># BARDEVICE</span>
<span class="preprocessor"></span>client2 =&gt; <span class="keyword">new</span> System_bus()
{
  dev =&gt; wrap(hw-root.BARDEVICE);
}
</pre></div><p>Assigning clients PCI devices could look like this:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor"># This is a configuration snippet for PCI device selection</span>
<span class="preprocessor"></span>
pciclient =&gt; <span class="keyword">new</span> System_bus()
{
  pci_storage[] =&gt; wrap(hw-root.match(<span class="stringliteral">&quot;PCI/CC_01&quot;</span>));
  pci_net[] =&gt; wrap(hw-root.match(<span class="stringliteral">&quot;PCI/CC_02&quot;</span>));
  pci_mm[] =&gt; wrap(hw-root.match(<span class="stringliteral">&quot;PCI/CC_04&quot;</span>))
}
</pre></div><p>The CC numbers are PCI class codes. You can also use <code>REV_</code>, <code>VEN_</code>, <code>DEV_</code> and <code>SUBSYS_</code> to specify revision, vendor, device and subsystem with a hex number. </p>
</div>
    <div style="background-color: #fff; border-width: 1px 0 0 0; border-color: #000; border-style: solid; text-align: center; margin-top: 10px">
    L4Re - L4 Runtime Environment
    </div>
   </div>
  </body>
</html>
