<html>
  <head>
    <title>L4Re Reference Manual</title>      
    <link href="doxygen.css" rel="stylesheet" type="text/css">
    <link href="tabs.css" rel="stylesheet" type="text/css">
  </HEAD>

  <body style="background: #fff url(header-bg.png) repeat-x scroll 0 0">
   <div>
    <div style="text-align: center; margin-bottom: 10px; border-width: 0 0 1px 0; border-color: #000; border-style: solid">
    L4Re - L4 Runtime Environment
    </div>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>l4/re/util/dataspace_svr</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// vi:ft=cpp</span>
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * (c) 2008-2009 Adam Lackorzynski &lt;adam@os.inf.tu-dresden.de&gt;,</span>
<a name="l00004"></a>00004 <span class="comment"> *               Alexander Warg &lt;warg@os.inf.tu-dresden.de&gt;,</span>
<a name="l00005"></a>00005 <span class="comment"> *               Torsten Frenzel &lt;frenzel@os.inf.tu-dresden.de&gt;</span>
<a name="l00006"></a>00006 <span class="comment"> *     economic rights: Technische Universit√§t Dresden (Germany)</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This file is part of TUD:OS and distributed under the terms of the</span>
<a name="l00009"></a>00009 <span class="comment"> * GNU General Public License 2.</span>
<a name="l00010"></a>00010 <span class="comment"> * Please see the COPYING-GPL-2 file for details.</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * As a special exception, you may use this file as part of a free software</span>
<a name="l00013"></a>00013 <span class="comment"> * library without restriction.  Specifically, if other files instantiate</span>
<a name="l00014"></a>00014 <span class="comment"> * templates or use macros or inline functions from this file, or you compile</span>
<a name="l00015"></a>00015 <span class="comment"> * this file and link it with other files to produce an executable, this</span>
<a name="l00016"></a>00016 <span class="comment"> * file does not by itself cause the resulting executable to be covered by</span>
<a name="l00017"></a>00017 <span class="comment"> * the GNU General Public License.  This exception does not however</span>
<a name="l00018"></a>00018 <span class="comment"> * invalidate any other reasons why the executable file might be covered by</span>
<a name="l00019"></a>00019 <span class="comment"> * the GNU General Public License.</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 <span class="preprocessor">#pragma once</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;cstddef&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;l4/sys/types.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;l4/cxx/list&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;l4/cxx/ipc_server&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;l4/cxx/ipc_stream&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;l4/cxx/minmax&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;l4/re/dataspace&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;l4/re/dataspace-sys.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;l4/re/protocols&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">inline</span>
<a name="l00035"></a>00035 <a class="code" href="classL4_1_1Ipc_1_1Ostream.html" title="Output stream for IPC marshalling.">L4::Ipc::Ostream</a> &amp;operator &lt;&lt; (<a class="code" href="classL4_1_1Ipc_1_1Ostream.html" title="Output stream for IPC marshalling.">L4::Ipc::Ostream</a> &amp;s,
<a name="l00036"></a>00036                                <a class="code" href="structL4Re_1_1Dataspace_1_1Stats.html" title="Information about the data space.">L4Re::Dataspace::Stats</a> <span class="keyword">const</span> &amp;st)
<a name="l00037"></a>00037 { s.<a class="code" href="classL4_1_1Ipc_1_1Ostream.html#a9126fd9f4bf60133eef4edb021da5cab" title="Put an array with size elements of type T into the stream.">put</a>(st); <span class="keywordflow">return</span> s; }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keyword">namespace </span>L4Re { <span class="keyword">namespace </span>Util {
<a name="l00040"></a>00040 
<a name="l00048"></a><a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html">00048</a> <span class="keyword">class </span><a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html" title="Dataspace server class.">Dataspace_svr</a>
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050 <span class="keyword">private</span>:
<a name="l00051"></a>00051   <span class="keyword">typedef</span> L4::Ipc::Gen_fpage&lt;L4::Ipc::Snd_item&gt; Snd_fpage;
<a name="l00052"></a>00052 <span class="keyword">public</span>:
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   <span class="keyword">typedef</span> Snd_fpage::Map_type Map_type;
<a name="l00055"></a>00055   <span class="keyword">typedef</span> Snd_fpage::Cacheopt Cache_type;
<a name="l00056"></a>00056   <span class="keyword">enum</span> Rw_type {
<a name="l00057"></a>00057       Read_only = 0,
<a name="l00058"></a>00058       Writable = 1,
<a name="l00059"></a>00059   };
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html" title="Dataspace server class.">Dataspace_svr</a>() <span class="keywordflow">throw</span>()
<a name="l00063"></a>00063   : _ds_start(0), _ds_size(0), _map_flags(Snd_fpage::Map),
<a name="l00064"></a>00064   _cache_flags(Snd_fpage::Cached)
<a name="l00065"></a>00065   {}
<a name="l00066"></a>00066 
<a name="l00067"></a>00067   <span class="keyword">virtual</span> ~<a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html" title="Dataspace server class.">Dataspace_svr</a>() <span class="keywordflow">throw</span>() {}
<a name="l00068"></a>00068 
<a name="l00081"></a>00081   <span class="keywordtype">int</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#adaaf91df936c69820649c2a346e5b623" title="Map a region of the dataspace.">map</a>(<a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> offs, <a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> spot, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags,
<a name="l00082"></a>00082           <a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> <a class="code" href="group__cxx__api.html#ga90dd0646443b89cd0df8ec5b0884fccd" title="Get the minimum of a and b.">min</a>, <a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> <a class="code" href="group__cxx__api.html#ga788ff889b86b4690e8777c508a6f4314" title="Get the maximum of a and b.">max</a>, L4::Ipc::Snd_fpage &amp;memory);
<a name="l00083"></a>00083 
<a name="l00097"></a><a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#a4b60e81d9651549471990480f3eb4b52">00097</a>   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#a4b60e81d9651549471990480f3eb4b52" title="A hook that is called as the first operation in each map request.">map_hook</a>(<a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> offs, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags,
<a name="l00098"></a>00098                        <a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> min, <a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> max)
<a name="l00099"></a>00099   {
<a name="l00100"></a>00100     (void)offs; (void)flags; (void)min; (void)max;
<a name="l00101"></a>00101     <span class="keywordflow">return</span> 0;
<a name="l00102"></a>00102   }
<a name="l00103"></a>00103 
<a name="l00113"></a>00113   <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#acbdfcf6194da26d19550037de365843e" title="Return physical address for a virtual address.">phys</a>(<a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> offset, <a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> &amp;phys_addr, <a class="code" href="group__l4__basic__types.html#ga08c1e83a068ded7add134b188cd44967" title="Signed size type.">l4_size_t</a> &amp;phys_size) <span class="keywordflow">throw</span>();
<a name="l00114"></a>00114   
<a name="l00120"></a><a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#af20b3923eb39501f40ac3372dd198af1">00120</a>   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#af20b3923eb39501f40ac3372dd198af1" title="Take a reference to this dataspace.">take</a>() throw()
<a name="l00121"></a>00121   {}
<a name="l00122"></a>00122 
<a name="l00130"></a><a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#a446e7024c788ff319d927693ed0efbf6">00130</a>   <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#a446e7024c788ff319d927693ed0efbf6" title="Release a reference to this dataspace.">release</a>() throw()
<a name="l00131"></a>00131   { <span class="keywordflow">return</span> 0; }
<a name="l00132"></a>00132 
<a name="l00143"></a><a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#a0489efec40eaffc7a90c837005930d25">00143</a>   <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#a0489efec40eaffc7a90c837005930d25" title="Copy from src dataspace to this destination dataspace.">copy</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dst_offs, <a class="code" href="group__l4__basic__types.html#ga1c2c4b333f75b1d05b59855910f2b9cb" title="Unsigned machine word.">l4_umword_t</a> src_id,
<a name="l00144"></a>00144                              <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> src_offs, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size) <span class="keywordflow">throw</span>()
<a name="l00145"></a>00145     { (void)dst_offs; (void)src_id; (void)src_offs; (void)size; <span class="keywordflow">return</span> 0; }
<a name="l00146"></a>00146   
<a name="l00153"></a>00153   <span class="keyword">virtual</span> <span class="keywordtype">long</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#a876dae28c6e515f9f10bdb5d8380c5c0" title="Clear a region in the dataspace.">clear</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> offs, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size) <span class="keyword">const</span> <span class="keywordflow">throw</span>();
<a name="l00154"></a>00154   
<a name="l00160"></a><a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#afce833f6d78e80785e41c0d04cbb7de7">00160</a>   <span class="keyword">virtual</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#afce833f6d78e80785e41c0d04cbb7de7" title="Define the size of the flexpage to map.">page_shift</a>() <span class="keyword">const</span> throw()
<a name="l00161"></a>00161   { <span class="keywordflow">return</span> L4_LOG2_PAGESIZE; }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> is_static() <span class="keyword">const</span> throw()
<a name="l00164"></a>00164   { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   <span class="keywordtype">int</span> dispatch(<a class="code" href="group__l4__basic__types.html#ga1c2c4b333f75b1d05b59855910f2b9cb" title="Unsigned machine word.">l4_umword_t</a> obj, <a class="code" href="classL4_1_1Ipc_1_1Iostream.html" title="Input/Output stream for IPC [un]marshalling.">L4::Ipc::Iostream</a> &amp;ios);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="keyword">protected</span>:
<a name="l00169"></a>00169   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size() <span class="keyword">const</span> throw()
<a name="l00170"></a>00170   { <span class="keywordflow">return</span> _ds_size; }
<a name="l00171"></a>00171   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> map_flags() <span class="keyword">const</span> throw()
<a name="l00172"></a>00172   { <span class="keywordflow">return</span> _map_flags; }
<a name="l00173"></a>00173   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> rw_flags() <span class="keyword">const</span> throw()
<a name="l00174"></a>00174   { <span class="keywordflow">return</span> _rw_flags; }
<a name="l00175"></a>00175   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> is_writable() <span class="keyword">const</span> throw()
<a name="l00176"></a>00176   { <span class="keywordflow">return</span> _rw_flags &amp; Writable; }
<a name="l00177"></a>00177   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page_size() <span class="keyword">const</span> throw()
<a name="l00178"></a>00178   { <span class="keywordflow">return</span> 1UL &lt;&lt; <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#afce833f6d78e80785e41c0d04cbb7de7" title="Define the size of the flexpage to map.">page_shift</a>(); }
<a name="l00179"></a>00179   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> round_size() <span class="keyword">const</span> throw()
<a name="l00180"></a>00180   { <span class="keywordflow">return</span> <a class="code" href="group__l4__memory__api.html#ga8b1180cad341f2ed7ff0da47c61b30f0" title="Round address up to the next flex page with bits size.">l4_round_size</a>(size(), <a class="code" href="classL4Re_1_1Util_1_1Dataspace__svr.html#afce833f6d78e80785e41c0d04cbb7de7" title="Define the size of the flexpage to map.">page_shift</a>()); }
<a name="l00181"></a>00181   <span class="keywordtype">bool</span> check_limit(<a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> offset) <span class="keyword">const</span> <span class="keywordflow">throw</span>()
<a name="l00182"></a>00182   { <span class="keywordflow">return</span> offset &lt; round_size(); }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="keyword">protected</span>:
<a name="l00185"></a>00185   <span class="keywordtype">void</span> size(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> size) <span class="keywordflow">throw</span>() { _ds_size = size; }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   <a class="code" href="group__l4__basic__types.html#ga4087b991c40c0d2fcde9ca331049a4d4" title="Address type.">l4_addr_t</a> _ds_start;
<a name="l00188"></a>00188   <a class="code" href="group__l4__basic__types.html#ga08c1e83a068ded7add134b188cd44967" title="Signed size type.">l4_size_t</a> _ds_size;
<a name="l00189"></a>00189   Map_type _map_flags;
<a name="l00190"></a>00190   Cache_type _cache_flags;
<a name="l00191"></a>00191   Rw_type  _rw_flags;
<a name="l00192"></a>00192 };
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 }}
</pre></div></div>
</div>
    <div style="background-color: #fff; border-width: 1px 0 0 0; border-color: #000; border-style: solid; text-align: center; margin-top: 10px">
    L4Re - L4 Runtime Environment
    </div>
   </div>
  </body>
</html>
